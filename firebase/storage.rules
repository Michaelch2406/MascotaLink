rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Regla específica para las fotos de perfil de las mascotas.
    // Permite escribir si el nombre del archivo comienza con el UID del dueño.
    match /foto_perfil_mascota/{fileName} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && fileName.matches(request.auth.uid + "_.*")
    }

    // Regla general para carpetas de usuario (dueños, paseadores).
    // Permite escribir si el nombre de la carpeta comienza con el UID del usuario.
    match /{folder}/{userId}/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && userId.matches(request.auth.uid + "_.*")
    }
  }
}
